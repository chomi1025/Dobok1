generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
  address   Json?
  birthDate DateTime
  name      String
  role      String   @default("user")
  phone     String?  @unique
  username  String   @unique
  orders    Order[]
}

enum Role {
  USER
  ADMIN
}

model Category {
  id        Int        @id @default(autoincrement())
  name      String
  parentId  Int?
  slug      String     @unique
  sortOrder Int?
  parent    Category?  @relation("CategoryToCategory", fields: [parentId], references: [id], onDelete: SetNull)
  children  Category[] @relation("CategoryToCategory")
  products  Product[]
}

model Product {
  id       Int      @id @default(autoincrement())
  name     String   @unique
  price    Int
  stock    Int
  category Category @relation(fields: [categoryId], references: [id])
  categoryId Int
}


enum OrderStatus {
  PAYMENT_COMPLETE
  PREPARING
  SHIPPING
  DELIVERED
  CANCELLED
}

model Order {
  id          Int         @id @default(autoincrement())
  orderNumber String      @unique   // ✅ 여기 추가
  date        DateTime
  total       Int
  status      OrderStatus
  userId      Int
  user        User        @relation(fields: [userId], references: [id])
  items       OrderItem[]
}



model OrderItem {
  id      Int @id @default(autoincrement())
  orderId Int

  productId    Int
  productName  String
  productImage String?

  optionText String?
  unitPrice  Int
  quantity   Int
  totalPrice Int

  createdAt DateTime @default(now())

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
}
